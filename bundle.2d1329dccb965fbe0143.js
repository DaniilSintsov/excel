(function(){"use strict";var __webpack_modules__={781:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){function parse(value=""){if(value.startsWith("="))try{return eval(value.slice(1))}catch(t){return value}return value}__webpack_require__.d(__webpack_exports__,{Q:function(){return parse}})},615:function(t,e,s){function n(t){return"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1)}function r(t,e){return t>e&&([e,t]=[t,e]),new Array(e-t+1).fill("").map(((e,s)=>t+s))}function i(t,e=null){if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}function a(t,e){return"object"==typeof t&&"object"==typeof e?JSON.stringify(t)===JSON.stringify(e):t===e}function o(t){return t.replace(/([A-Z])/g,(t=>`-${t[0].toLowerCase()}`))}function c(t={}){return Object.keys(t).map((e=>`${o(e)}: ${t[e]}`)).join(";")}function l(t,e){let s;return function(...n){clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),t.apply(this,n)}),e)}}function u(t){return JSON.parse(JSON.stringify(t))}function h(t){t.preventDefault()}s.r(e),s.d(e,{camelToKebabCase:function(){return o},capitalize:function(){return n},clone:function(){return u},debounce:function(){return l},isEqual:function(){return a},preventDefault:function(){return h},range:function(){return r},storage:function(){return i},toInlineStyles:function(){return c}})}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=function(t,e){for(var s in e)__webpack_require__.o(e,s)&&!__webpack_require__.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};!function(){class t{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}text(t){return void 0!==t?(this.$el.textContent=t,this):"input"===this.$el.tagName.toLowerCase()?this.$el.value.trim():this.$el.textContent.trim()}clear(){return this.html(""),this}append(e){return e instanceof t&&(e=e.$el),Element.prototype.append?this.$el.append(e):this.$el.appendChild(e),this}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}closest(t){return e(this.$el.closest(t))}getCoords(){return this.$el.getBoundingClientRect()}find(t){return e(this.$el.querySelector(t))}findAll(t){return this.$el.querySelectorAll(t)}css(t={}){Object.keys(t).forEach((e=>this.$el.style[e]=t[e]))}getStyles(t=[]){return t.reduce(((t,e)=>(t[e]=this.$el.style[e],t)),{})}id(t){if(t){const t=this.id().split(":");return{row:+t[0],col:+t[1]}}return this.data.id}focus(){return this.$el.focus(),this}attr(t,e){return e?(this.$el.setAttribute(t,e),this):this.$el.getAttribute()}addClass(t){return this.$el.classList.add(t),this}removeClass(t){return this.$el.classList.remove(t),this}get data(){return this.$el.dataset}}function e(e){return new t(e)}e("div").html("<h1>Test</h1>").clear(),e.create=(t,s="")=>{const n=document.createElement(t);return s&&n.classList.add(s),e(n)};class s{static get path(){return window.location.hash.slice(1)}static get param(){return s.path.split("/")[1]}static navigate(t){window.location.hash=t}}function n(){return e.create("div","loader").html('\n    <div class="lds-dual-ring"></div>\n  ')}var r=__webpack_require__(615);function i(t){const e=(0,r.storage)(t);return`\n    <li class="db__record">\n      <a href="#excel/${t.split(":")[1]}">${e.title}</a>\n      <strong>\n        ${new Date(e.openedDate).toLocaleDateString()}\n        ${new Date(e.openedDate).toLocaleTimeString()}\n      </strong>\n    </li>\n  `}class a{constructor(t){this.params=t||Date.now().toString()}getRoot(){throw new Error('Method "getRoot" should be implemented')}afterRender(){}destroy(){}}class o{constructor(){this.listeners={}}dispatch(t,...e){return!!Array.isArray(this.listeners[t])&&(this.listeners[t].forEach((t=>{t(...e)})),!0)}subscribe(t,e){return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),()=>{this.listeners[t]=this.listeners[t].filter((t=>t!==e))}}}class c{constructor(t){this.store=t,this.sub=null,this.prevState={}}subscribeComponents(t){this.prevState=this.store.getState(),this.sub=this.store.subscribe((e=>{Object.keys(e).forEach((s=>{(0,r.isEqual)(this.prevState[s],e[s])||t.forEach((t=>{if(t.isWatching(s)){const n={[s]:e[s]};t.storeChanged(n)}}))})),this.prevState=this.store.getState()}))}unsubscribeFromStore(){this.sub.unsubscribe()}}const l="TABLE_RESIZE",u="CHANGE_TEXT",h="APPLY_STYLE",d="CURRENT_STYLE",p="CHANGE_TITLE",f="UPDATE_DATE";class m{constructor(t){this.components=t.components||[],this.store=t.store,this.emitter=new o,this.subscriber=new c(this.store)}getRoot(){const t=e.create("div","excel"),s={emitter:this.emitter,store:this.store};return this.components=this.components.map((n=>{const r=e.create("div",n.className),i=new n(r,s);return r.html(i.toHTML()),t.append(r),i})),t}init(){document.addEventListener("contextmenu",r.preventDefault),this.store.dispatch(f),this.subscriber.subscribeComponents(this.components),this.components.forEach((t=>t.init()))}destroy(){this.subscriber.unsubscribeFromStore(),this.components.forEach((t=>t.destroy())),document.removeEventListener("contextmenu",r.preventDefault)}}function _(t){return`on${(0,r.capitalize)(t)}`}class b extends class{constructor(t,e=[]){if(!t)throw new Error("No $root provided for DomListener");this.$root=t,this.listeners=e}initDomListeners(){this.listeners.forEach((t=>{const e=_(t);if(!this[e])throw new Error(`Method ${e} is not implemented in ${this.name} Component`);this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeDomListeners(){this.listeners.forEach((t=>{const e=_(t);this.$root.off(t,this[e])}))}}{constructor(t,e={}){super(t,e.listeners),this.name=e.name||"",this.store=e.store,this.emitter=e.emitter,this.subscribe=e.subscribe||[],this.unSubscribers=[],this.prepare()}prepare(){}toHTML(){return""}$dispatch(t,...e){this.emitter.dispatch(t,...e)}storeChanged(){}isWatching(t){return this.subscribe.includes(t)}$on(t,e){const s=this.emitter.subscribe(t,e);this.unSubscribers.push(s)}$emit(t){this.store.dispatch(t)}init(){this.initDomListeners()}destroy(){this.removeDomListeners(),this.unSubscribers.forEach((t=>t()))}}const g={textAlign:"left",fontWeight:"normal",textDecoration:"none",fontStyle:"normal"},v="Новая таблица";class w extends b{static className="header";constructor(t,e){super(t,{name:"Header",listeners:["input","click"],...e})}prepare(){this.onInput=(0,r.debounce)(this.onInput,300)}toHTML(){return`\n      <input type="text"\n               class="header__input"\n               value="${this.store.getState().title||v}">\n\n      <div class="header__buttons">\n        <div class="header__btn btn">\n          <span class="material-icons" data-button="exit">logout</span>\n        </div>\n\n        <div class="header__btn btn">\n          <span class="material-icons" data-button="remove">delete_outline</span>\n        </div>\n      </div>\n    `}onClick(t){const n=e(t.target);"remove"===n.data.button?confirm("Вы действительно хотите удалить эту таблицу?")&&(localStorage.removeItem(`excel:${s.param}`),s.navigate("")):"exit"===n.data.button&&s.navigate("")}onInput(t){const s=e(t.target);var n;this.$emit((n=s.text(),{type:p,data:n}))}}class y extends b{constructor(...t){super(...t)}get template(){return JSON.stringify(this.state,null,2)}initState(t={}){this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.html(this.template)}}function $(t){const e=`\n    data-type="button"\n    data-value='${JSON.stringify(t.value)}'\n  `;return`\n    <div ${e}\n         class="toolbar__btn btn ${t.active?"active":""}">\n      <span class="material-icons"\n            ${e}>${t.icon}</span>\n    </div>\n  `}class S extends y{static className="toolbar";constructor(t,e){super(t,{name:"Toolbar",listeners:["click"],subscribe:["currentStyles"],...e})}prepare(){this.initState(g)}get template(){return[{icon:"format_align_left",active:"left"===(t=this.state).textAlign,value:{textAlign:"left"}},{icon:"format_align_justify",active:"center"===t.textAlign,value:{textAlign:"center"}},{icon:"format_align_right",active:"right"===t.textAlign,value:{textAlign:"right"}},{icon:"format_bold",active:"bold"===t.fontWeight,value:{fontWeight:"bold"===t.fontWeight?"normal":"bold"}},{icon:"format_italic",active:"italic"===t.fontStyle,value:{fontStyle:"italic"===t.fontStyle?"normal":"italic"}},{icon:"format_underlined",active:"underline"===t.textDecoration,value:{textDecoration:"underline"===t.textDecoration?"none":"underline"}}].map($).join("");var t}toHTML(){return this.template}storeChanged(t){this.setState(t.currentStyles)}onClick(t){const s=e(t.target);if("button"===s.data.type){const t=JSON.parse(s.data.value);this.$dispatch("toolbar:applyStyle",t)}}}class x extends b{static className="formula";constructor(t,e){super(t,{name:"Formula",listeners:["input","keydown"],subscribe:["currentText"],...e})}init(){super.init(),this.$formula=this.$root.find("#formula"),this.$on("table:select",(t=>{this.$formula.text(t.data.value)}))}toHTML(){return'\n      <div class="formula__info">fx</div>\n\n      <div id="formula"\n           class="formula__input"\n           contenteditable\n           spellcheck="false"></div>\n    '}storeChanged({currentText:t}){this.$formula.text(t)}onInput(t){this.$dispatch("formula:input",e(t.target).text())}onKeydown(t){["Enter","Tab"].includes(t.code)&&(t.preventDefault(),this.$dispatch("formula:onEnter"))}}var E=__webpack_require__(781);function T(t,e){return(t[e]||120)+"px"}function k(t,e){return function(s,n){const i=`${e}:${n}`,a=T(t.colState,n),o=t.dataState[i];return`\n      <div class="table__cell"\n           contenteditable\n           data-col="${n}"\n           data-id="${i}"\n           data-value="${o||""}"\n           data-type="cell"\n           style="${(0,r.toInlineStyles)({...g,...t?.styleState[i]})}; width: ${a}">${(0,E.Q)(o)||""}</div>\n    `}}function A({col:t,index:e,width:s}){return`\n    <div class="table__column"\n         data-type="resizable"\n         data-col="${e}"\n         style="width: ${s}">\n      ${t}\n      <div class="col-resize" data-resize="col"></div>\n    </div>\n  `}function C(t,e,s){const n=t?'<div class="row-resize" data-resize="row"></div>':"",r=function(t,e){return(t[e]||24)+"px"}(s,t);return`\n    <div class="table__row"\n         data-type="resizable"\n         style="height: ${r}"\n         data-row="${t}">\n      <div class="table__row-info">\n        ${t||""}\n        ${n}\n      </div>\n      <div class="table__row-data">${e}</div>\n    </div>\n  `}function L(t,e){return String.fromCharCode(65+e)}class D{static className="selected";constructor(){this.group=[],this.current=null}select(t){this.clear(),t.focus().addClass(D.className),this.group.push(t),this.current=t}clear(){this.group.forEach((t=>t.removeClass(D.className))),this.group=[]}get selectedIds(){return this.group.map((t=>t.id()))}selectGroup(t=[]){this.clear(),this.group=t,this.group.forEach((t=>t.addClass(D.className)))}applyStyle(t){this.group.forEach((e=>e.css(t)))}}class N extends b{static className="table";constructor(t,e){super(t,{name:"Table",listeners:["mousedown","keydown","input"],...e})}toHTML(){return function(t=15,e={}){const s=[],n=new Array(26).fill("").map(L).map(function(t){return function(e,s){return{col:e,index:s,width:T(t.colState,s)}}}(e)).map(A).join("");s.push(C(null,n,{}));for(let n=0;n<t;n++){const t=new Array(26).fill("").map(k(e,n)).join("");s.push(C(n+1,t,e.rowState))}return s.join("")}(20,this.store.getState())}prepare(){this.selection=new D}init(){super.init(),this.selectCell(this.$root.find('[data-id="0:0"]')),this.$on("formula:input",(t=>{this.selection.current.attr("data-value",t).text((0,E.Q)(t)),this.updateTextInStore(t)})),this.$on("formula:onEnter",(()=>{this.selection.current.focus()})),this.$on("toolbar:applyStyle",(t=>{var e;this.selection.applyStyle(t),this.$emit((e={value:t,ids:this.selection.selectedIds},{type:h,data:e}))}))}selectCell(t){this.selection.select(t),this.$dispatch("table:select",t);const e=t.getStyles(Object.keys(g));this.$emit({type:d,data:e})}async resizeTable(t){try{const s=await function(t,s){return new Promise((n=>{const r=e(s.target),i=r.closest('[data-type="resizable"]'),a=i.getCoords(),o=t.findAll(`[data-col="${i.data.col}"]`),c=r.data.resize,l="col"===c?"bottom":"right";let u;r.css({[l]:"-5000px"}),document.onmousemove=t=>{if("col"===c){const e=t.pageX-a.right;u=a.width+e,r.css({right:-e+"px"})}else{const e=t.pageY-a.bottom;u=a.height+e,r.css({bottom:-e+"px"})}},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,"col"===c?(i.css({width:u+"px"}),r.css({bottom:0,right:"-3px"}),o.forEach((t=>t.style.width=u+"px"))):(i.css({height:u+"px"}),r.css({right:0,bottom:"-3px"}),o.forEach((t=>t.style.height=u+"px"))),n({value:u,type:c,id:i.data[c]})}}))}(this.$root,t);this.$emit(function(t){return{type:l,data:t}}(s))}catch(t){console.warn("Resize error",t.message)}}onMousedown(t){if(function(t){return t.target.dataset.resize}(t))this.resizeTable(t);else if(function(t){return"cell"===t.target.dataset.type}(t)){const s=e(t.target);if(t.shiftKey){const t=function(t,e){const s=t.id(!0),n=e.id(!0),i=(0,r.range)(n.col,s.col),a=(0,r.range)(n.row,s.row);return i.reduce(((t,e)=>(a.forEach((s=>t.push(`${s}:${e}`))),t)),[])}(s,this.selection.current).map((t=>this.$root.find(`[data-id="${t}"]`)));this.selection.selectGroup(t)}else this.selectCell(s)}}onKeydown(t){const{code:e}=t;if(["Enter","Tab","ArrowLeft","ArrowRight","ArrowDown","ArrowUp"].includes(e)){t.preventDefault();const s=this.selection.current.id(!0),n=this.$root.find(function(t,{col:e,row:s}){switch(t){case"Enter":case"ArrowDown":s++;break;case"Tab":case"ArrowRight":e++;break;case"ArrowLeft":e=e-1<0?0:e-1;break;case"ArrowUp":s=s-1<0?0:s-1}return`[data-id="${s}:${e}"]`}(e,s));this.selectCell(n)}}updateTextInStore(t){var e;this.$emit((e={id:this.selection.current.id(),value:t},{type:u,data:e}))}onInput(t){this.updateTextInStore(e(t.target).text())}}function O(t,e){let s,n;switch(e.type){case l:return s="col"===e.data.type?"colState":"rowState",{...t,[s]:I(t,s,e)};case u:return s="dataState",{...t,currentText:e.data.value,dataState:I(t,s,e)};case d:return{...t,currentStyles:e.data};case h:return s="styleState",n=t[s]||{},e.data.ids.forEach((t=>{n[t]={...n[t],...e.data.value}})),{...t,[s]:n,currentStyles:{...t.currentStyles,...e.data.value}};case p:return{...t,title:e.data};case f:return{...t,openedDate:(new Date).toJSON()};default:return t}}function I(t,e,s){const n=t[e]||{};return n[s.data.id]=s.data.value,n}const R={title:v,rowState:{},colState:{},dataState:{},styleState:{},currentText:"",currentStyles:g,openedDate:(new Date).toJSON()};const{debounce:j}=__webpack_require__(615);class q{constructor(t,e=300){this.client=t,this.listen=j(this.listen.bind(this),e)}listen(t){this.client.save(t)}get(){return this.client.get()}}class H{constructor(t){this.name=`excel:${t}`}save(t){return(0,r.storage)(this.name,t),Promise.resolve()}get(){return new Promise((t=>{const e=(0,r.storage)(this.name);setTimeout((()=>{t(e)}),1e3)}))}}new class{constructor(t,s){if(!t)throw new Error("Selector is not provided in Router");this.$placeholder=e(t),this.routes=s,this.loader=new n,this.page=null,this.changePageHandler=this.changePageHandler.bind(this),this.init()}init(){window.addEventListener("hashchange",this.changePageHandler),this.changePageHandler()}async changePageHandler(){this.page&&this.page.destroy(),this.$placeholder.clear().append(this.loader);const t=s.path.includes("excel")?this.routes.excel:this.routes.dashboard;this.page=new t(s.param);const e=await this.page.getRoot();this.$placeholder.clear().append(e),this.page.afterRender()}destroy(){window.removeEventListener("hashchange",this.changePageHandler)}}("#app",{dashboard:class extends a{getRoot(){const t=Date.now().toString();return e.create("div","db").html(`\n      <div class="db">\n        <div class="db__header">\n          <h1>Таблицы - панель управления</h1>\n        </div>\n\n        <div class="db__new">\n          <div class="db__view">\n            <a href="#excel/${t}" class="db__create">Новая <br> таблица</a>\n          </div>\n        </div>\n\n        <div class="db__table db__view">\n          ${function(){const t=function(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s.includes("excel")&&t.push(s)}return t}();return t.length?`\n    <div class="db__list-header">\n      <span>Название</span>\n      <span>Дата открытия</span>\n    </div>\n\n    <ul class="db__list">\n      ${t.map(i).join("")}\n    </ul>\n  `:"<p>Вы пока не создали не одной таблицы</p>"}()}\n        </div>\n      </div>\n    `)}},excel:class extends a{constructor(t){super(t),this.storeSub=null,this.processor=new q(new H(this.params))}async getRoot(){const t=function(t,e={}){let s=t({...e},{type:"__INIT__"}),n=[];return{subscribe:t=>(n.push(t),{unsubscribe(){n=n.filter((e=>e!==t))}}),dispatch(e){s=t(s,e),n.forEach((t=>t(s)))},getState:()=>JSON.parse(JSON.stringify(s))}}(O,(e=await this.processor.get())?(t=>({...t,currentStyles:g,currentText:""}))(e):(0,r.clone)(R));var e;return this.storeSub=t.subscribe(this.processor.listen),this.excel=new m({components:[w,S,x,N],store:t}),this.excel.getRoot()}afterRender(){this.excel.init()}destroy(){this.excel.destroy(),this.storeSub.unsubscribe()}}})}()})();